---
- import_playbook: wifi_sutd.yml
- name: Playbook for setting up a new worker node
  hosts: pi-cluster
  tasks:
  - name: Expand filesystem to fill disk
    command: raspi-config --expand-rootfs
    become: yes
    notify:
      - reboot
  - name: Install system packages
    apt:
      name: psutil
      state: present
      with_items:
      - htop
      - nmap
  - name: Install python3 packages
    apt:
      name: python3-dev
      state: present
      with_items:
      - python3-pip
      - python3-numpy
  - name: Upgrade pip and setuptools
    pip:
      requirements: files/pip-upgrade.txt
      extra_args: --upgrade
  - name: Configure Python packages
    pip:
      requirements: ../requirements.txt

- import_playbook: wifi_testnet.yml
- import_playbook: upgrade.yml
- import_playbook: reboot.yml